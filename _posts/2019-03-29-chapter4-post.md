---
layout: post
title: "[인사이드 안드로이드] 챕터 4 - JNI와 NDK"
description:
headline:
modified: 2019-03-29
category: Android
tags: [Android]
imagefeature: cover_1.jpg
mathjax:
chart:
comments: true
share: ture
featured: true
---

# [인사이드 안드로이드]


## Chapter4 - JNI와 NDK


---------------------------------------


### 안드로이드와 JNI  

안드로이드 프레임워크는 자바와 C/C++ 기반 모듈이 계층별로 구성돼 있다. C/C++ 레이어와 자바 레이어가 서로 상호 작용하면서 동작하고 있다.  
이처럼 프레임워크에서 유기적으로 동작하게 만들려면 자바레이어(상위)와 C/C++ 레이어(하위)를 상호 연결해 주는 매개체가 필요하다.  
자바와 C/C++ 모듈 간의 인터페이스를 가능하게 해주는 것이 바로 **JNI(Java Native Interface)**다.  

JNI는 일반적으로 다음과 같은 경우에 주로 활용한다.  
* 빠른 처리 속도를 요구하는 루틴 작성(자바는 C/C++보다 느리기 때문에 C/C++로 작성하고 JNI를 통해 자바에서 호출하는 방법)  
* 하드웨어 제어(하드웨어 제어 코드를 C로 작성하면 JNI를 통해 자바에서도 하드웨어 제어 가능)  
* 기존 C/C++ 프로그램의 재사용  


**JNI에 대해 알아야 하는 이유**  
* 안드로이드에서는 JNI를 이용하여 자바와 C/C++의 장점을 동시에 활용하고 있다.  
* 안드로이드 SDK를 토대로 만든 안드로이드 애플리케이션은 달빅 가상 머신(Dalvik Virtual Machine) 위에서 동작하는 자바 기반의 프로그램이다. 때문에 C/C++로 생성한 애플리케이션에 비해 느린 실행속도 등의 한계를 가진다. 프로그램의 주요 모듈은 자바 개발자가, 성능에 민감한 모듈은 C/C++ 개발자가 작성한다.  
* 안드로이드를 탑재할 장치에 안드로이드 프레임워크에서 지원하지 않는 하드웨어가 설치돼 있다면 디바이스 드라이버를 C언어로 구현하고 JNI로 매핑시켜야 한다.  

### JNI의 기본 원리 이해  

#### 자바에서 C 라이브러리 함수 호출하기  

**전체적인 개발 순서**  
1단계 : 자바 코드 작성  
2단계 : 자바 코드 컴파일  
3단계 : C 헤더 파일 생성  
4단계 : c 코드 작성  
5단계 : c 공유 라이브러리 생성  
6단계 : 자바 프로그램 실행  

**1단계 : 자바 코드 작성**  
자바 코드에서 네이티브 메서드를 선언한다.  

**2단계 : 자바 코드 컴파일**  
1단계에서 작성한 소스 코드를 javac(자바 컴파일러)로 컴파일한다. 컴파일 후에 .class파일이 생성되지만 자바 가상 머신이 로딩할 C라이브러리를 찾지 못하여 실행 시 오류가 생긴다.  

**3단계 : C 헤어 파일 생성**  
1단계에서 선언한 네이티브 메서드의 시그너처와 비슷하게 .dll로 C코드를 구현한다. 하지만 자바 가상 머신은 일반적인 형식의 C 함수를 자바 네이티브 메서드와 직접 매핑하지 않는다.  
JNI 명세에서 정한 대로 함수 원형을 작성하면 자바 가상 머신은 해당 함수가 네이티브 메서드와 매핑될 함수라고 식별하게 된다.  

이러한 작업을 도와주는 것이 바로 javah라는 툴이다. 이 툴을 이용하여 헤더파일을 생성한다.  

**4단계 : C/C++ 코드 구현**  
헤더파일에 정의된 함수 원형을 .c파일에 복사하여 구현을 완료한다. 이 때 매개변수의 이름을 지정해 주어야한다.  

**5단계 : C 공유 라이브러리 생성**  
3~4단계에서 작성한 헤더 파일과 소스 파일을 가지고 공유 라이브러리를 만든다. .dll파일이 생성된다.  

**6단계 : 자바 프로그램 실행**  
자바 클래스를 슬행하면 앞서 작업한 내용잉 제대로 실행되는 것을 볼 수 있다.  
